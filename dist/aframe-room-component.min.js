!function(e,o){if("object"==typeof exports&&"object"==typeof module)module.exports=o();else if("function"==typeof define&&define.amd)define([],o);else{var t=o();for(var n in t)("object"==typeof exports?exports:e)[n]=t[n]}}(self,(()=>(()=>{"use strict";var e={315:e=>{var o="a-doorlink",t="a-room";e.exports.Component=AFRAME.registerComponent("ceiling",{init:function(){var e;console.info("initializing ceiling");var n=null===(e=this.el.parentEl)||void 0===e?void 0:e.localName;if(n!==o&&n!==t){var i='a-ceiling elements must have an "'.concat(o,'" or "').concat(t,'" parent');throw new Error(i)}}})},603:e=>{var o="a-wall";e.exports.Component=AFRAME.registerComponent("doorhole",{init:function(){var e,t=this;if(console.info("initializing doorhole"),(null===(e=this.el.parentEl)||void 0===e?void 0:e.localName)!==o){var n='a-doorhole elements must have an "'.concat(o,'" parent');throw new Error(n)}this.el.verts=[],this.el.getDoorlink=function(){return t.el.sceneEl.querySelector('a-doorlink[from="#'.concat(t.el.id,'"], a-doorlink[to="#').concat(t.el.id,'"]'))}}})},838:e=>{var o="a-scene",t="a-wall";e.exports.Component=AFRAME.registerComponent("doorlink",{schema:{from:{type:"selector"},to:{type:"selector"},height:{type:"number",default:2},width:{type:"number",default:.8}},init:function(){var e;console.info("initializing doorlink");var n=null===(e=this.el.parentEl)||void 0===e?void 0:e.localName;if(n!==o&&n!==t){var i='a-doorlink elements must have an "'.concat(o,'" or "').concat(t,'" parent');throw new Error(i)}var r=this.el;r.ceiling=r.querySelector("a-ceiling"),r.floor=r.querySelector("a-floor"),r.sides=r.querySelector("a-sides")},update:function(){var e,o;console.info("updating doorlink"),null===(e=this.el.sceneEl.systems)||void 0===e||null===(o=e.building)||void 0===o||o.buildDoorlink(this.el)}})},545:e=>{var o="a-doorlink",t="a-room";e.exports.Component=AFRAME.registerComponent("floor",{init:function(){var e;console.info("initializing floor");var n=null===(e=this.el.parentEl)||void 0===e?void 0:e.localName;if(n!==o&&n!==t){var i='a-floor elements must have an "'.concat(o,'" or "').concat(t,'" parent');throw new Error(i)}}})},24:(e,o,t)=>{t(315),t(603),t(838),t(545),t(158),t(290),t(339)},158:e=>{e.exports.Component=AFRAME.registerComponent("room",{schema:{outside:{type:"boolean"},height:{type:"number",default:2.4},width:{type:"number"},length:{type:"number"}},init:function(){console.info("initializing room");var e=this.el,o=null==e?void 0:e.getAttribute("room"),t=o.length,n=o.width,i=Array.from(e.querySelectorAll("a-wall"));if((n||t)&&(!n||!t)){var r="rooms with WIDTH must also have LENGTH (and vice versa)";throw console.error(r),new Error(r)}if(n&&t&&4!==i.length){var l="rooms with WIDTH and LENGTH must have four walls!";throw console.error(l),new Error(l)}e.ceiling=e.querySelector("a-ceiling"),e.floor=e.querySelector("a-floor"),e.walls=i},update:function(){var e,o;console.info("updating room"),null===(e=this.el.sceneEl.systems)||void 0===e||null===(o=e.building)||void 0===o||o.buildRoom(this.el)}})},290:e=>{var o="a-doorlink";e.exports.Component=AFRAME.registerComponent("sides",{init:function(){var e;if(console.info("initializing sides"),(null===(e=this.el.parentEl)||void 0===e?void 0:e.localName)!==o){var t='a-sides elements must have an "'.concat(o,'" parent');throw new Error(t)}}})},339:e=>{var o="a-room";e.exports.Component=AFRAME.registerComponent("wall",{schema:{height:{type:"number"}},init:function(){var e,t=this;if(console.info("initializing wall"),(null===(e=this.el.parentEl)||void 0===e?void 0:e.localName)!==o){var n='a-wall elements must have an "'.concat(o,'" parent');throw new Error(n)}var i=Array.from(this.el.querySelectorAll("a-doorhole"));this.el.doorholes=i.sort((function(e,o){var t,n,i,r;return(null==e||null===(t=e.object3D)||void 0===t||null===(n=t.position)||void 0===n?void 0:n.x)-(null==o||null===(i=o.object3D)||void 0===i||null===(r=i.position)||void 0===r?void 0:r.x)})),this.el.getHeight=function(){var e,o,n;return(null===(e=t.el.getAttribute("wall"))||void 0===e?void 0:e.height)||(null===(o=t.el.parentEl)||void 0===o||null===(n=o.getAttribute("room"))||void 0===n?void 0:n.height)}}})},268:()=>{AFRAME.registerPrimitive("a-ceiling",{defaultComponents:{ceiling:{}},mappings:{}})},614:()=>{AFRAME.registerPrimitive("a-doorhole",{defaultComponents:{doorhole:{}},mappings:{}})},809:()=>{AFRAME.registerPrimitive("a-doorlink",{defaultComponents:{doorlink:{}},mappings:{from:"doorlink.from",to:"doorlink.to",height:"doorlink.height",width:"doorlink.width"}})},311:()=>{AFRAME.registerPrimitive("a-floor",{defaultComponents:{floor:{}},mappings:{}})},541:()=>{AFRAME.registerPrimitive("a-room",{defaultComponents:{room:{}},mappings:{outside:"room.outside",height:"room.height",width:"room.width",length:"room.length"}})},414:()=>{AFRAME.registerPrimitive("a-sides",{defaultComponents:{sides:{}},mappings:{}})},407:()=>{AFRAME.registerPrimitive("a-wall",{defaultComponents:{wall:{}},mappings:{height:"wall.height"}})},813:(e,o,t)=>{t(268),t(614),t(809),t(311),t(541),t(414),t(407)},182:()=>{function e(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=o(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,l=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw l}}}}function o(e,o){if(e){if("string"==typeof e)return t(e,o);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?t(e,o):void 0}}function t(e,o){(null==o||o>e.length)&&(o=e.length);for(var t=0,n=new Array(o);t<o;t++)n[t]=e[t];return n}var n=1e-4,i=function(t,n){var i,r,l,a=[],s=e(t.getIndex().array);try{for(s.s();!(i=s.n()).done;){var u=i.value,c=(r=n(new THREE.Vector3(t.attributes.position.getX(u),t.attributes.position.getY(u),t.attributes.position.getZ(u)),u%3),l=2,function(e){if(Array.isArray(e))return e}(r)||function(e,o){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var n,i,r,l,a=[],s=!0,u=!1;try{if(r=(t=t.call(e)).next,0===o){if(Object(t)!==t)return;s=!1}else for(;!(s=(n=r.call(t)).done)&&(a.push(n.value),a.length!==o);s=!0);}catch(e){u=!0,i=e}finally{try{if(!s&&null!=t.return&&(l=t.return(),Object(l)!==l))return}finally{if(u)throw i}}return a}}(r,l)||o(r,l)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),d=c[0],v=c[1];a[2*u+0]=d,a[2*u+1]=v}}catch(e){s.e(e)}finally{s.f()}t.setAttribute("uv",new THREE.BufferAttribute(new Float32Array(a),2))},r=function(e,o,t,n,r){i(e,(function(e){return[e[o]*n,e[t]*r]}))},l=function(e){e.computeVertexNormals(),e.computeBoundingBox(),e.computeBoundingSphere()},a=function(e,o,t,n){var i=new THREE.Vector3(t,n,0);e.object3D.localToWorld(i),o.verts.push(i)},s=function(e){var o,t=e.getDoorlink(),i=e.parentEl,r=null==i?void 0:i.nextWallEl;if(t&&r){var l=new THREE.Vector3;i.object3D.getWorldPosition(l);var a=new THREE.Vector3;r.object3D.getWorldPosition(a);var s=new THREE.Vector3;t.object3D.getWorldPosition(s);var u=s.x-l.x,c=s.z-l.z,d=a.x-l.x,v=a.z-l.z,h=Math.atan2(v,d),m=Math.sqrt(d*d+v*v),f=(null===(o=t.getAttribute("doorlink"))||void 0===o?void 0:o.width)/2,p=u*Math.cos(-h)-c*Math.sin(-h);p=Math.max(p,f+n),p=Math.min(p,m-f-n),e.object3D.position.set(p,0,0)}},u=function(e,o,t,n){for(var i,a,s,u,c,d=new THREE.Shape,v=0;v<e.length;v++){var h=e[v],m=h.object3D.position.x,f=h.object3D.position.z;v?d.lineTo(m,f):d.moveTo(m,f)}for(var p=new THREE.ShapeGeometry(d),g=0;g<e.length;g++){var y=e[g],b=new THREE.Vector3(p.attributes.position.getX(g),p.attributes.position.getY(g),p.attributes.position.getZ(g));b.set(b.x,y.object3D.position.y,b.y),t&&(b.y+=y.getHeight()),p.attributes.position.setXYZ(g,b.x,b.y,b.z)}var E=!1;t||(E=!E),n&&(E=!E),E&&function(e){for(var o=e.getIndex().array,t=0;t<o.length;t+=3){var n=o[t+2];o[t+2]=o[t+1],o[t+1]=n}e.getIndex().needsUpdate=!0}(p),r(p,"x","z",t?1:-1,1),l(p),o.myMeshes||(o.myMeshes=[]);var w=t?"ceiling":"floor",A=(null==o||null===(i=o.components)||void 0===i||null===(a=i.material)||void 0===a?void 0:a.material)||(null==o||null===(s=o.parentEl)||void 0===s||null===(u=s.components)||void 0===u||null===(c=u.material)||void 0===c?void 0:c.material);o.myMeshes[w]?(o.myMeshes[w].geometry=p,o.myMeshes[w].material=A):(o.myMeshes[w]=new THREE.Mesh(p,A),o.setObject3D(w,o.myMeshes[w]))},c=function(o){var t=null==o?void 0:o.getAttribute("room"),i=t.outside,c=t.length,d=t.width,v=null==o?void 0:o.walls;d&&c&&(v[0].object3D.position.set(0,0,0),v[1].object3D.position.set(d,0,0),v[2].object3D.position.set(d,0,c),v[3].object3D.position.set(0,0,c)),function(e,o){for(var t=0,n=0;n<e.length;n++){var i=e[n],r=e[(n+1)%e.length],l=i.object3D.position,a=l.x,s=l.z,u=r.object3D.position;t+=(u.x-a)*(u.z+s)}var c=!1;t>0&&(c=!c),o&&(c=!c),c&&e.reverse()}(v,i);for(var h=0;h<v.length;h++){var m,f,p,g,y,b,E,w,A,M,x,j,R,D=v[h],T=D.nextWallEl=v[(h+1)%v.length],k=T.object3D.position.x-D.object3D.position.x,H=T.object3D.position.y-D.object3D.position.y,S=T.object3D.position.z-D.object3D.position.z,C=T.getHeight()-D.getHeight(),z=Math.atan2(S,k),F=Math.sqrt(k*k+S*S);D.object3D.rotation.y=THREE.MathUtils.degToRad(-z/Math.PI*180);var q=new THREE.Shape;q.moveTo(0,D.getHeight()),q.lineTo(0,0);var I,P=e(D.doorholes);try{for(P.s();!(I=P.n()).done;){var G=I.value;s(G);var N=G.getDoorlink();if(N)for(var W=-1;W<=1;W+=2){var B=G.object3D.position.x+N.getAttribute("doorlink").width/2*W,O=B/F*H,V=O+N.getAttribute("doorlink").height,L=O+(D.getHeight()+B/F*C)-n;V>L&&(V=L),a(D,G,B,O),a(D,G,B,V),W<0?(q.lineTo(B,O),q.lineTo(B,V)):(q.lineTo(B,V),q.lineTo(B,O))}}}catch(e){P.e(e)}finally{P.f()}q.lineTo(F,(null==T||null===(m=T.object3D)||void 0===m||null===(f=m.position)||void 0===f?void 0:f.y)-(null==D||null===(p=D.object3D)||void 0===p||null===(g=p.position)||void 0===g?void 0:g.y)),q.lineTo(F,(null==T||null===(y=T.object3D)||void 0===y||null===(b=y.position)||void 0===b?void 0:b.y)-(null==D||null===(E=D.object3D)||void 0===E||null===(w=E.position)||void 0===w?void 0:w.y)+T.getHeight());var U=new THREE.ShapeGeometry(q);r(U,"x","y",1,1),l(U);var X=(null==D||null===(A=D.components)||void 0===A||null===(M=A.material)||void 0===M?void 0:M.material)||(null==D||null===(x=D.parentEl)||void 0===x||null===(j=x.components)||void 0===j||null===(R=j.material)||void 0===R?void 0:R.material);D.myMesh?(D.myMesh.geometry=U,D.myMesh.material=X):(D.myMesh=new THREE.Mesh(U,X),D.setObject3D("wallMesh",D.myMesh))}u(v,null==o?void 0:o.floor,!1,i),u(v,null==o?void 0:o.ceiling,!0,i)},d=function(o){var t=o.getAttribute("doorlink"),n=t.from,r=t.to,a=null==n?void 0:n.verts,s=null==r?void 0:r.verts;if(a&&s){var u,c=e(o.children);try{var d=function(){var e=u.value;if(!e.components)return"continue";for(var o=function(){var o,r,u,c,d,v=n[t];if(!e.components[v])return"continue";var h=(null==e||null===(o=e.components)||void 0===o||null===(r=o.material)||void 0===r?void 0:r.material)||(null==e||null===(u=e.parentEl)||void 0===u||null===(c=u.components)||void 0===c||null===(d=c.material)||void 0===d?void 0:d.material);if(e.myGeoms||(e.myGeoms=[]),!e.myGeoms[v]){var m=new THREE.BufferGeometry;e.myGeoms[v]=m;var f=new THREE.Mesh(m,h);m.meshRef=f,e.setObject3D(v,f);var p=[];p.push(0,1,2,1,3,2),"sides"===v&&p.push(4,5,6,5,7,6),m.setIndex(p)}var g=e.myGeoms[v];g.meshRef.material=h;var y=[],b=function(o){var t=o.clone();e.object3D.worldToLocal(t),y.push(t.x,t.y,t.z)},E=function(){g.setAttribute("position",new THREE.BufferAttribute(new Float32Array(y),3))};switch(v){case"floor":b(s[0]),b(s[2]),b(a[2]),b(a[0]),E(),i(g,(function(e,o){return[1-o%2,1-Math.floor(o/2)]}));break;case"ceiling":b(s[3]),b(s[1]),b(a[1]),b(a[3]),E(),i(g,(function(e,o){return[o%2,1-Math.floor(o/2)]}));break;case"sides":b(s[2]),b(s[3]),b(a[0]),b(a[1]),b(a[2]),b(a[3]),b(s[0]),b(s[1]),E(),i(g,(function(e,o){var t=[];return t[0]=Math.floor(o/2),t[1]=o%2,o<4&&(t[0]=1-t[0]),t}))}l(g)},t=0,n=["sides","floor","ceiling"];t<n.length;t++)o()};for(c.s();!(u=c.n()).done;)d()}catch(e){c.e(e)}finally{c.f()}}};AFRAME.registerSystem("building",{init:function(){console.log("initializing building"),this.el.rooms=this.el.querySelectorAll("a-room"),this.el.doorlinks=this.el.querySelectorAll("a-doorlink"),this.el.updateReady=!1,this.el.addEventListener("loaded",this.initialBuild)},initialBuild:function(){console.info("building..."),this.object3D.updateMatrixWorld();var o,t=e(this.rooms);try{for(t.s();!(o=t.n()).done;){var n=o.value;c(n)}}catch(e){t.e(e)}finally{t.f()}var i,r=e(this.doorlinks);try{for(r.s();!(i=r.n()).done;){var l=i.value;d(l)}}catch(e){r.e(e)}finally{r.f()}this.updateReady=!0},buildRoom:function(e){this.el.updateReady&&c(e)},buildDoorlink:function(e){this.el.updateReady&&d(e)}})},517:(e,o,t)=>{t(182)}},o={};function t(n){var i=o[n];if(void 0!==i)return i.exports;var r=o[n]={exports:{}};return e[n](r,r.exports,t),r.exports}return t(24),t(813),t(517),{}})()));
//# sourceMappingURL=aframe-room-component.min.js.map