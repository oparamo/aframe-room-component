!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var o=e();for(var n in o)("object"==typeof exports?exports:t)[n]=o[n]}}(self,(()=>(()=>{"use strict";var t={315:t=>{var e="a-doorlink",o="a-room";t.exports.Component=AFRAME.registerComponent("ceiling",{init:function(){var t,n=null===(t=this.el.parentEl)||void 0===t?void 0:t.localName;if(n!==e&&n!==o){var r="<a-ceiling> must be a child of a <".concat(e,"> or <").concat(o,">.");throw new Error(r)}}})},603:t=>{var e="a-wall";t.exports.Component=AFRAME.registerComponent("doorhole",{init:function(){var t,o=this;if((null===(t=this.el.parentEl)||void 0===t?void 0:t.localName)!==e){var n="<a-doorhole> must be a child of a <".concat(e,">.");throw new Error(n)}this.el.vertices=[],this.el.getDoorlink=function(){return o.el.sceneEl.querySelector('a-doorlink[from="#'.concat(o.el.id,'"], a-doorlink[to="#').concat(o.el.id,'"]'))}}})},838:t=>{var e="a-scene",o="a-wall";t.exports.Component=AFRAME.registerComponent("doorlink",{schema:{from:{type:"selector"},to:{type:"selector"},height:{type:"number",default:2},width:{type:"number",default:.8}},init:function(){var t,n=null===(t=this.el.parentEl)||void 0===t?void 0:t.localName;if(n!==e&&n!==o){var r="<a-doorlink> must be a child of a <".concat(e,"> or <").concat(o,">.");throw new Error(r)}},update:function(){var t;null===(t=this.el.sceneEl.systems)||void 0===t||null===(t=t.building)||void 0===t||t.buildDoorlink(this.el)}})},545:t=>{var e="a-doorlink",o="a-room";t.exports.Component=AFRAME.registerComponent("floor",{init:function(){var t,n=null===(t=this.el.parentEl)||void 0===t?void 0:t.localName;if(n!==e&&n!==o){var r="<a-floor> must be a child of a <".concat(e,"> or <").concat(o,">.");throw new Error(r)}}})},24:(t,e,o)=>{o(315),o(603),o(838),o(545),o(306),o(158),o(290),o(339)},306:t=>{function e(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,n=new Array(e);o<e;o++)n[o]=t[o];return n}t.exports.Component=AFRAME.registerComponent("random-building",{schema:{minRoomSize:{type:"vec3",default:{x:2,y:2,z:2}},maxRoomSize:{type:"vec3",default:{x:3,y:4,z:3}},minRooms:{type:"int",default:1},maxRooms:{type:"int",default:5},boundary:{type:"vec3",default:{x:20,y:0,z:20}},maxPositionAttempts:{type:"int",default:50}},init:function(){this.generateBuilding()},generateBuilding:function(){for(var t=this.data,e=t.minRoomSize,o=t.maxRoomSize,n=t.minRooms,r=t.maxRooms,i=t.boundary,l=t.maxPositionAttempts,a=Math.floor(Math.random()*(r-n+1)+n),u=[],s=0,c=0;c<a&&s!=l;c++){var d={x:Math.random()*(o.x-e.x)+e.x,y:Math.random()*(o.y-e.y)+e.y,z:Math.random()*(o.z-e.z)+e.z};for(s=0;s<l;s++){var f={x:Math.random()*i.x,y:0,z:Math.random()*i.z};if(!this.checkCollision(f,d,u)){var v=this.createRoom(d,f);u.push(v),this.el.appendChild(v.room);break}d.x=Math.max(e.x,.9*d.x),d.z=Math.max(e.z,.9*d.z)}}},checkCollision:function(t,o,n){var r,i=function(t,o){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,o){if(t){if("string"==typeof t)return e(t,o);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?e(t,o):void 0}}(t))||o&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,a=!0,u=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){u=!0,l=t},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw l}}}}(n);try{for(i.s();!(r=i.n()).done;){var l=r.value,a=Math.abs(t.x-l.position.x)<(o.x+l.size.x)/2,u=Math.abs(t.z-l.position.z)<(o.z+l.size.z)/2;if(a&&u)return!0}}catch(t){i.e(t)}finally{i.f()}return!1},createRoom:function(t,e){var o=document.createElement("a-entity");return o.setAttribute("geometry",{primitive:"box",width:t.x,height:t.y,depth:t.z}),o.setAttribute("position",e),{room:o,position:e,size:t}}})},158:t=>{t.exports.Component=AFRAME.registerComponent("room",{schema:{outside:{type:"boolean"},height:{type:"number",default:2.4},width:{type:"number"},length:{type:"number"}},init:function(){var t=this.el,e=null==t?void 0:t.getAttribute("room"),o=e.length,n=e.width,r=Array.from(t.querySelectorAll("a-wall"));if((n||o)&&(!n||!o)){var i="<a-room> with WIDTH must also have LENGTH (and vice versa).";throw console.error(i),new Error(i)}if(n&&o&&4!==r.length){var l="<a-room> with WIDTH and LENGTH must have four walls.";throw console.error(l),new Error(l)}t.ceiling=t.querySelector("a-ceiling"),t.floor=t.querySelector("a-floor"),t.walls=r},update:function(){var t;null===(t=this.el.sceneEl.systems)||void 0===t||null===(t=t.building)||void 0===t||t.buildRoom(this.el)}})},290:t=>{var e="a-doorlink";t.exports.Component=AFRAME.registerComponent("sides",{init:function(){var t;if((null===(t=this.el.parentEl)||void 0===t?void 0:t.localName)!==e){var o="<a-sides> must be a child of a <".concat(e,">.");throw new Error(o)}}})},339:t=>{var e="a-room";t.exports.Component=AFRAME.registerComponent("wall",{schema:{height:{type:"number"}},init:function(){var t,o=this;if((null===(t=this.el.parentEl)||void 0===t?void 0:t.localName)!==e){var n="<a-wall> must be a child of a <".concat(e,">");throw new Error(n)}var r=Array.from(this.el.querySelectorAll("a-doorhole"));this.el.doorholes=r.sort((function(t,e){var o,n;return(null==t||null===(o=t.object3D)||void 0===o||null===(o=o.position)||void 0===o?void 0:o.x)-(null==e||null===(n=e.object3D)||void 0===n||null===(n=n.position)||void 0===n?void 0:n.x)})),this.el.getHeight=function(){var t,e;return(null===(t=o.el.getAttribute("wall"))||void 0===t?void 0:t.height)||(null===(e=o.el.parentEl)||void 0===e||null===(e=e.getAttribute("room"))||void 0===e?void 0:e.height)}}})},268:()=>{AFRAME.registerPrimitive("a-ceiling",{defaultComponents:{ceiling:{}},mappings:{}})},614:()=>{AFRAME.registerPrimitive("a-doorhole",{defaultComponents:{doorhole:{}},mappings:{}})},809:()=>{AFRAME.registerPrimitive("a-doorlink",{defaultComponents:{doorlink:{}},mappings:{from:"doorlink.from",to:"doorlink.to",height:"doorlink.height",width:"doorlink.width"}})},311:()=>{AFRAME.registerPrimitive("a-floor",{defaultComponents:{floor:{}},mappings:{}})},541:()=>{AFRAME.registerPrimitive("a-room",{defaultComponents:{room:{}},mappings:{outside:"room.outside",height:"room.height",width:"room.width",length:"room.length"}})},414:()=>{AFRAME.registerPrimitive("a-sides",{defaultComponents:{sides:{}},mappings:{}})},407:()=>{AFRAME.registerPrimitive("a-wall",{defaultComponents:{wall:{}},mappings:{height:"wall.height"}})},813:(t,e,o)=>{o(268),o(614),o(809),o(311),o(541),o(414),o(407)},182:(t,e,o)=>{function n(t,e){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=function(t,e){if(t){if("string"==typeof t)return r(t,e);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?r(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){o&&(t=o);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,a=!0,u=!1;return{s:function(){o=o.call(t)},n:function(){var t=o.next();return a=t.done,t},e:function(t){u=!0,l=t},f:function(){try{a||null==o.return||o.return()}finally{if(u)throw l}}}}function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,n=new Array(e);o<e;o++)n[o]=t[o];return n}var i=o(651),l=i.buildDoorlink,a=i.buildRoom;t.exports.System=AFRAME.registerSystem("building",{init:function(){this.el.addEventListener("loaded",this.initialBuild),this.el.updateReady=!1},initialBuild:function(){var t=this.querySelectorAll("a-doorlink"),e=this.querySelectorAll("a-room");this.object3D.updateMatrixWorld();var o,r=n(e);try{for(r.s();!(o=r.n()).done;){var i=o.value;a(i)}}catch(t){r.e(t)}finally{r.f()}var u,s=n(t);try{for(s.s();!(u=s.n()).done;){var c=u.value;l(c)}}catch(t){s.e(t)}finally{s.f()}this.updateReady=!0},buildRoom:function(t){this.el.updateReady&&a(t)},buildDoorlink:function(t){this.el.updateReady&&l(t)}})},651:t=>{function e(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=o(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,a=!0,u=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){u=!0,l=t},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw l}}}}function o(t,e){if(t){if("string"==typeof t)return n(t,e);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?n(t,e):void 0}}function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,n=new Array(e);o<e;o++)n[o]=t[o];return n}var r=1e-4,i=function(t,n){var r,i,l,a=[],u=e(t.getIndex().array);try{for(u.s();!(r=u.n()).done;){var s=r.value,c=(i=n(new THREE.Vector3(t.attributes.position.getX(s),t.attributes.position.getY(s),t.attributes.position.getZ(s)),s%3),l=2,function(t){if(Array.isArray(t))return t}(i)||function(t,e){var o=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=o){var n,r,i,l,a=[],u=!0,s=!1;try{if(i=(o=o.call(t)).next,0===e){if(Object(o)!==o)return;u=!1}else for(;!(u=(n=i.call(o)).done)&&(a.push(n.value),a.length!==e);u=!0);}catch(t){s=!0,r=t}finally{try{if(!u&&null!=o.return&&(l=o.return(),Object(l)!==l))return}finally{if(s)throw r}}return a}}(i,l)||o(i,l)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),d=c[0],f=c[1];a[2*s+0]=d,a[2*s+1]=f}}catch(t){u.e(t)}finally{u.f()}t.setAttribute("uv",new THREE.BufferAttribute(new Float32Array(a),2))},l=function(t,e,o,n,r){i(t,(function(t){return[t[e]*n,t[o]*r]}))},a=function(t){t.computeVertexNormals()},u=function(t,e,o){var n=t.clone();e.object3D.worldToLocal(n),o.push(n.x,n.y,n.z)},s=function(t,e,o,n){var r=new THREE.Vector3(o,n,0);t.object3D.localToWorld(r),e.vertices.push(r)},c=function(t){var e,o=t.getDoorlink(),n=t.parentEl,i=null==n?void 0:n.nextWallEl;if(o&&i){var l=new THREE.Vector3;n.object3D.getWorldPosition(l);var a=new THREE.Vector3;i.object3D.getWorldPosition(a);var u=new THREE.Vector3;o.object3D.getWorldPosition(u);var s=u.x-l.x,c=u.z-l.z,d=a.x-l.x,f=a.z-l.z,v=Math.atan2(f,d),m=Math.sqrt(d*d+f*f),h=(null===(e=o.getAttribute("doorlink"))||void 0===e?void 0:e.width)/2,p=s*Math.cos(-v)-c*Math.sin(-v);p=Math.max(p,h+r),p=Math.min(p,m-h-r),t.object3D.position.set(p,0,0)}},d=function(t,e,o,n){for(var r,i,u=new THREE.Shape,s=0;s<t.length;s++){var c=t[s],d=c.object3D.position.x,f=c.object3D.position.z;s?u.lineTo(d,f):u.moveTo(d,f)}for(var v=new THREE.ShapeGeometry(u),m=0;m<t.length;m++){var h=t[m],p=new THREE.Vector3(v.attributes.position.getX(m),v.attributes.position.getY(m),v.attributes.position.getZ(m));p.set(p.x,h.object3D.position.y,p.y),o&&(p.y+=h.getHeight()),v.attributes.position.setXYZ(m,p.x,p.y,p.z)}var y=!1;o||(y=!y),n&&(y=!y),y&&function(t){for(var e=t.getIndex().array,o=0;o<e.length;o+=3){var n=e[o+2];e[o+2]=e[o+1],e[o+1]=n}t.getIndex().needsUpdate=!0}(v),l(v,"x","z",o?1:-1,1),a(v);var b=(null==e||null===(r=e.components)||void 0===r||null===(r=r.material)||void 0===r?void 0:r.material)||(null==e||null===(i=e.parentEl)||void 0===i||null===(i=i.components)||void 0===i||null===(i=i.material)||void 0===i?void 0:i.material);if(e.mesh)e.mesh.geometry=v,e.mesh.material=b;else{var g=o?"ceiling":"floor";e.mesh=new THREE.Mesh(v,b),e.setObject3D(g,e.mesh)}};t.exports={buildDoorlink:function(t){var o=t.getAttribute("doorlink"),n=o.from,r=o.to,l=null==n?void 0:n.vertices,s=null==r?void 0:r.vertices;if(l&&s){var c,d=e(t.children);try{for(d.s();!(c=d.n()).done;)for(var f=c.value,v=0,m=["sides","floor","ceiling"];v<m.length;v++){var h,p,y=m[v];if(f.components[y]){var b=(null==f||null===(h=f.components)||void 0===h||null===(h=h.material)||void 0===h?void 0:h.material)||(null==f||null===(p=f.parentEl)||void 0===p||null===(p=p.components)||void 0===p||null===(p=p.material)||void 0===p?void 0:p.material),g="sides"===y?[0,1,2,1,3,2,4,5,6,5,7,6]:[0,1,2,1,3,2],E=new THREE.BufferGeometry;E.setIndex(g),f.mesh=new THREE.Mesh(E,b),f.setObject3D(y,f.mesh);var w=[];switch(y){case"floor":u(s[0],f,w),u(s[2],f,w),u(l[2],f,w),u(l[0],f,w),E.setAttribute("position",new THREE.BufferAttribute(new Float32Array(w),3)),i(E,(function(t,e){return[1-e%2,1-Math.floor(e/2)]}));break;case"ceiling":u(s[3],f,w),u(s[1],f,w),u(l[1],f,w),u(l[3],f,w),E.setAttribute("position",new THREE.BufferAttribute(new Float32Array(w),3)),i(E,(function(t,e){return[e%2,1-Math.floor(e/2)]}));break;case"sides":u(s[2],f,w),u(s[3],f,w),u(l[0],f,w),u(l[1],f,w),u(l[2],f,w),u(l[3],f,w),u(s[0],f,w),u(s[1],f,w),E.setAttribute("position",new THREE.BufferAttribute(new Float32Array(w),3)),i(E,(function(t,e){var o=[];return o[0]=Math.floor(e/2),o[1]=e%2,e<4&&(o[0]=1-o[0]),o}))}a(E)}}}catch(t){d.e(t)}finally{d.f()}}},buildRoom:function(t){var o=null==t?void 0:t.getAttribute("room"),n=o.outside,i=o.length,u=o.width,f=null==t?void 0:t.walls;u&&i&&(f[0].object3D.position.set(0,0,0),f[1].object3D.position.set(u,0,0),f[2].object3D.position.set(u,0,i),f[3].object3D.position.set(0,0,i)),function(t,e){for(var o=0,n=0;n<t.length;n++){var r=t[n],i=t[(n+1)%t.length],l=r.object3D.position,a=l.x,u=l.z,s=i.object3D.position;o+=(s.x-a)*(s.z+u)}var c=!1;o>0&&(c=!c),e&&(c=!c),c&&t.reverse()}(f,n);for(var v=0;v<f.length;v++){var m,h,p,y,b,g,E=f[v],w=E.nextWallEl=f[(v+1)%f.length],A=w.object3D.position.x-E.object3D.position.x,x=w.object3D.position.y-E.object3D.position.y,R=w.object3D.position.z-E.object3D.position.z,j=w.getHeight()-E.getHeight(),M=Math.atan2(R,A),D=Math.sqrt(A*A+R*R);E.object3D.rotation.y=THREE.MathUtils.degToRad(-M/Math.PI*180);var T=new THREE.Shape;T.moveTo(0,E.getHeight()),T.lineTo(0,0);var z,S=e(E.doorholes);try{for(S.s();!(z=S.n()).done;){var k=z.value;c(k);var H=k.getDoorlink();if(H)for(var C=-1;C<=1;C+=2){var F=k.object3D.position.x+H.getAttribute("doorlink").width/2*C,I=F/D*x,P=I+H.getAttribute("doorlink").height,O=I+(E.getHeight()+F/D*j)-r;P>O&&(P=O),s(E,k,F,I),s(E,k,F,P),C<0?(T.lineTo(F,I),T.lineTo(F,P)):(T.lineTo(F,P),T.lineTo(F,I))}}}catch(t){S.e(t)}finally{S.f()}T.lineTo(D,(null==w||null===(m=w.object3D)||void 0===m||null===(m=m.position)||void 0===m?void 0:m.y)-(null==E||null===(h=E.object3D)||void 0===h||null===(h=h.position)||void 0===h?void 0:h.y)),T.lineTo(D,(null==w||null===(p=w.object3D)||void 0===p||null===(p=p.position)||void 0===p?void 0:p.y)-(null==E||null===(y=E.object3D)||void 0===y||null===(y=y.position)||void 0===y?void 0:y.y)+w.getHeight());var q=new THREE.ShapeGeometry(T);l(q,"x","y",1,1),a(q);var B=(null==E||null===(b=E.components)||void 0===b||null===(b=b.material)||void 0===b?void 0:b.material)||(null==E||null===(g=E.parentEl)||void 0===g||null===(g=g.components)||void 0===g||null===(g=g.material)||void 0===g?void 0:g.material);E.mesh?(E.mesh.geometry=q,E.mesh.material=B):(E.mesh=new THREE.Mesh(q,B),E.setObject3D("wallMesh",E.mesh))}d(f,null==t?void 0:t.floor,!1,n),d(f,null==t?void 0:t.ceiling,!0,n)}}},517:(t,e,o)=>{o(182)}},e={};function o(n){var r=e[n];if(void 0!==r)return r.exports;var i=e[n]={exports:{}};return t[n](i,i.exports,o),i.exports}return o(24),o(813),o(517),{}})()));
//# sourceMappingURL=aframe-room-component.min.js.map