!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var o=e();for(var r in o)("object"==typeof exports?exports:t)[r]=o[r]}}(self,(()=>(()=>{"use strict";var t={315:t=>{var e="a-doorlink",o="a-room";t.exports.Component=AFRAME.registerComponent("ceiling",{init:function(){var t,r=null===(t=this.el.parentEl)||void 0===t?void 0:t.localName;if(r!==e&&r!==o){var n="<a-ceiling> must be a child of a <".concat(e,"> or <").concat(o,">.");throw new Error(n)}}})},603:t=>{var e="a-wall";t.exports.Component=AFRAME.registerComponent("doorhole",{init:function(){var t,o=this;if((null===(t=this.el.parentEl)||void 0===t?void 0:t.localName)!==e){var r="<a-doorhole> must be a child of a <".concat(e,">.");throw new Error(r)}this.el.vertices=[],this.el.getDoorlink=function(){return o.el.sceneEl.querySelector('a-doorlink[from="#'.concat(o.el.id,'"], a-doorlink[to="#').concat(o.el.id,'"]'))}}})},838:t=>{var e="a-scene",o="a-wall";t.exports.Component=AFRAME.registerComponent("doorlink",{schema:{from:{type:"selector"},to:{type:"selector"},height:{type:"number",default:2},width:{type:"number",default:.8}},init:function(){var t,r=null===(t=this.el.parentEl)||void 0===t?void 0:t.localName;if(r!==e&&r!==o){var n="<a-doorlink> must be a child of a <".concat(e,"> or <").concat(o,">.");throw new Error(n)}},update:function(){var t,e;null===(t=this.el.sceneEl.systems)||void 0===t||null===(e=t.building)||void 0===e||e.buildDoorlink(this.el)}})},545:t=>{var e="a-doorlink",o="a-room";t.exports.Component=AFRAME.registerComponent("floor",{init:function(){var t,r=null===(t=this.el.parentEl)||void 0===t?void 0:t.localName;if(r!==e&&r!==o){var n="<a-floor> must be a child of a <".concat(e,"> or <").concat(o,">.");throw new Error(n)}}})},24:(t,e,o)=>{o(315),o(603),o(838),o(545),o(158),o(290),o(339)},158:t=>{t.exports.Component=AFRAME.registerComponent("room",{schema:{outside:{type:"boolean"},height:{type:"number",default:2.4},width:{type:"number"},length:{type:"number"}},init:function(){var t=this.el,e=null==t?void 0:t.getAttribute("room"),o=e.length,r=e.width,n=Array.from(t.querySelectorAll("a-wall"));if((r||o)&&(!r||!o)){var i="<a-room> with WIDTH must also have LENGTH (and vice versa).";throw console.error(i),new Error(i)}if(r&&o&&4!==n.length){var l="<a-room> with WIDTH and LENGTH must have four walls.";throw console.error(l),new Error(l)}t.ceiling=t.querySelector("a-ceiling"),t.floor=t.querySelector("a-floor"),t.walls=n},update:function(){var t,e;null===(t=this.el.sceneEl.systems)||void 0===t||null===(e=t.building)||void 0===e||e.buildRoom(this.el)}})},290:t=>{var e="a-doorlink";t.exports.Component=AFRAME.registerComponent("sides",{init:function(){var t;if((null===(t=this.el.parentEl)||void 0===t?void 0:t.localName)!==e){var o="<a-sides> must be a child of a <".concat(e,">.");throw new Error(o)}}})},339:t=>{var e="a-room";t.exports.Component=AFRAME.registerComponent("wall",{schema:{height:{type:"number"}},init:function(){var t,o=this;if((null===(t=this.el.parentEl)||void 0===t?void 0:t.localName)!==e){var r="<a-wall> must be a child of a <".concat(e,">");throw new Error(r)}var n=Array.from(this.el.querySelectorAll("a-doorhole"));this.el.doorholes=n.sort((function(t,e){var o,r,n,i;return(null==t||null===(o=t.object3D)||void 0===o||null===(r=o.position)||void 0===r?void 0:r.x)-(null==e||null===(n=e.object3D)||void 0===n||null===(i=n.position)||void 0===i?void 0:i.x)})),this.el.getHeight=function(){var t,e,r;return(null===(t=o.el.getAttribute("wall"))||void 0===t?void 0:t.height)||(null===(e=o.el.parentEl)||void 0===e||null===(r=e.getAttribute("room"))||void 0===r?void 0:r.height)}}})},268:()=>{AFRAME.registerPrimitive("a-ceiling",{defaultComponents:{ceiling:{}},mappings:{}})},614:()=>{AFRAME.registerPrimitive("a-doorhole",{defaultComponents:{doorhole:{}},mappings:{}})},809:()=>{AFRAME.registerPrimitive("a-doorlink",{defaultComponents:{doorlink:{}},mappings:{from:"doorlink.from",to:"doorlink.to",height:"doorlink.height",width:"doorlink.width"}})},311:()=>{AFRAME.registerPrimitive("a-floor",{defaultComponents:{floor:{}},mappings:{}})},541:()=>{AFRAME.registerPrimitive("a-room",{defaultComponents:{room:{}},mappings:{outside:"room.outside",height:"room.height",width:"room.width",length:"room.length"}})},414:()=>{AFRAME.registerPrimitive("a-sides",{defaultComponents:{sides:{}},mappings:{}})},407:()=>{AFRAME.registerPrimitive("a-wall",{defaultComponents:{wall:{}},mappings:{height:"wall.height"}})},813:(t,e,o)=>{o(268),o(614),o(809),o(311),o(541),o(414),o(407)},182:(t,e,o)=>{function r(t,e){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=function(t,e){if(t){if("string"==typeof t)return n(t,e);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?n(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){o&&(t=o);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,a=!0,u=!1;return{s:function(){o=o.call(t)},n:function(){var t=o.next();return a=t.done,t},e:function(t){u=!0,l=t},f:function(){try{a||null==o.return||o.return()}finally{if(u)throw l}}}}function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,r=new Array(e);o<e;o++)r[o]=t[o];return r}var i=o(651),l=i.buildDoorlink,a=i.buildRoom;AFRAME.registerSystem("building",{init:function(){this.el.addEventListener("loaded",this.initialBuild),this.el.updateReady=!1},initialBuild:function(){var t=this.querySelectorAll("a-doorlink"),e=this.querySelectorAll("a-room");this.object3D.updateMatrixWorld();var o,n=r(e);try{for(n.s();!(o=n.n()).done;){var i=o.value;a(i)}}catch(t){n.e(t)}finally{n.f()}var u,s=r(t);try{for(s.s();!(u=s.n()).done;){var c=u.value;l(c)}}catch(t){s.e(t)}finally{s.f()}this.updateReady=!0},buildRoom:function(t){this.el.updateReady&&a(t)},buildDoorlink:function(t){this.el.updateReady&&l(t)}})},651:t=>{function e(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=o(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,a=!0,u=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){u=!0,l=t},f:function(){try{a||null==r.return||r.return()}finally{if(u)throw l}}}}function o(t,e){if(t){if("string"==typeof t)return r(t,e);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?r(t,e):void 0}}function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,r=new Array(e);o<e;o++)r[o]=t[o];return r}var n=1e-4,i=function(t,r){var n,i,l,a=[],u=e(t.getIndex().array);try{for(u.s();!(n=u.n()).done;){var s=n.value,c=(i=r(new THREE.Vector3(t.attributes.position.getX(s),t.attributes.position.getY(s),t.attributes.position.getZ(s)),s%3),l=2,function(t){if(Array.isArray(t))return t}(i)||function(t,e){var o=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=o){var r,n,i,l,a=[],u=!0,s=!1;try{if(i=(o=o.call(t)).next,0===e){if(Object(o)!==o)return;u=!1}else for(;!(u=(r=i.call(o)).done)&&(a.push(r.value),a.length!==e);u=!0);}catch(t){s=!0,n=t}finally{try{if(!u&&null!=o.return&&(l=o.return(),Object(l)!==l))return}finally{if(s)throw n}}return a}}(i,l)||o(i,l)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),d=c[0],v=c[1];a[2*s+0]=d,a[2*s+1]=v}}catch(t){u.e(t)}finally{u.f()}t.setAttribute("uv",new THREE.BufferAttribute(new Float32Array(a),2))},l=function(t,e,o,r,n){i(t,(function(t){return[t[e]*r,t[o]*n]}))},a=function(t){t.computeVertexNormals()},u=function(t,e,o){var r=t.clone();e.object3D.worldToLocal(r),o.push(r.x,r.y,r.z)},s=function(t,e,o,r){var n=new THREE.Vector3(o,r,0);t.object3D.localToWorld(n),e.vertices.push(n)},c=function(t){var e,o=t.getDoorlink(),r=t.parentEl,i=null==r?void 0:r.nextWallEl;if(o&&i){var l=new THREE.Vector3;r.object3D.getWorldPosition(l);var a=new THREE.Vector3;i.object3D.getWorldPosition(a);var u=new THREE.Vector3;o.object3D.getWorldPosition(u);var s=u.x-l.x,c=u.z-l.z,d=a.x-l.x,v=a.z-l.z,f=Math.atan2(v,d),h=Math.sqrt(d*d+v*v),m=(null===(e=o.getAttribute("doorlink"))||void 0===e?void 0:e.width)/2,p=s*Math.cos(-f)-c*Math.sin(-f);p=Math.max(p,m+n),p=Math.min(p,h-m-n),t.object3D.position.set(p,0,0)}},d=function(t,e,o,r){for(var n,i,u,s,c,d=new THREE.Shape,v=0;v<t.length;v++){var f=t[v],h=f.object3D.position.x,m=f.object3D.position.z;v?d.lineTo(h,m):d.moveTo(h,m)}for(var p=new THREE.ShapeGeometry(d),g=0;g<t.length;g++){var b=t[g],y=new THREE.Vector3(p.attributes.position.getX(g),p.attributes.position.getY(g),p.attributes.position.getZ(g));y.set(y.x,b.object3D.position.y,y.y),o&&(y.y+=b.getHeight()),p.attributes.position.setXYZ(g,y.x,y.y,y.z)}var E=!1;o||(E=!E),r&&(E=!E),E&&function(t){for(var e=t.getIndex().array,o=0;o<e.length;o+=3){var r=e[o+2];e[o+2]=e[o+1],e[o+1]=r}t.getIndex().needsUpdate=!0}(p),l(p,"x","z",o?1:-1,1),a(p);var w=(null==e||null===(n=e.components)||void 0===n||null===(i=n.material)||void 0===i?void 0:i.material)||(null==e||null===(u=e.parentEl)||void 0===u||null===(s=u.components)||void 0===s||null===(c=s.material)||void 0===c?void 0:c.material);if(e.mesh)e.mesh.geometry=p,e.mesh.material=w;else{var A=o?"ceiling":"floor";e.mesh=new THREE.Mesh(p,w),e.setObject3D(A,e.mesh)}};t.exports={buildDoorlink:function(t){var o=t.getAttribute("doorlink"),r=o.from,n=o.to,l=null==r?void 0:r.vertices,s=null==n?void 0:n.vertices;if(l&&s){var c,d=e(t.children);try{for(d.s();!(c=d.n()).done;)for(var v=c.value,f=0,h=["sides","floor","ceiling"];f<h.length;f++){var m,p,g,b,y,E=h[f];if(v.components[E]){var w=(null==v||null===(m=v.components)||void 0===m||null===(p=m.material)||void 0===p?void 0:p.material)||(null==v||null===(g=v.parentEl)||void 0===g||null===(b=g.components)||void 0===b||null===(y=b.material)||void 0===y?void 0:y.material),A="sides"===E?[0,1,2,1,3,2,4,5,6,5,7,6]:[0,1,2,1,3,2],j=new THREE.BufferGeometry;j.setIndex(A),v.mesh=new THREE.Mesh(j,w),v.setObject3D(E,v.mesh);var x=[];switch(E){case"floor":u(s[0],v,x),u(s[2],v,x),u(l[2],v,x),u(l[0],v,x),j.setAttribute("position",new THREE.BufferAttribute(new Float32Array(x),3)),i(j,(function(t,e){return[1-e%2,1-Math.floor(e/2)]}));break;case"ceiling":u(s[3],v,x),u(s[1],v,x),u(l[1],v,x),u(l[3],v,x),j.setAttribute("position",new THREE.BufferAttribute(new Float32Array(x),3)),i(j,(function(t,e){return[e%2,1-Math.floor(e/2)]}));break;case"sides":u(s[2],v,x),u(s[3],v,x),u(l[0],v,x),u(l[1],v,x),u(l[2],v,x),u(l[3],v,x),u(s[0],v,x),u(s[1],v,x),j.setAttribute("position",new THREE.BufferAttribute(new Float32Array(x),3)),i(j,(function(t,e){var o=[];return o[0]=Math.floor(e/2),o[1]=e%2,e<4&&(o[0]=1-o[0]),o}))}a(j)}}}catch(t){d.e(t)}finally{d.f()}}},buildRoom:function(t){var o=null==t?void 0:t.getAttribute("room"),r=o.outside,i=o.length,u=o.width,v=null==t?void 0:t.walls;u&&i&&(v[0].object3D.position.set(0,0,0),v[1].object3D.position.set(u,0,0),v[2].object3D.position.set(u,0,i),v[3].object3D.position.set(0,0,i)),function(t,e){for(var o=0,r=0;r<t.length;r++){var n=t[r],i=t[(r+1)%t.length],l=n.object3D.position,a=l.x,u=l.z,s=i.object3D.position;o+=(s.x-a)*(s.z+u)}var c=!1;o>0&&(c=!c),e&&(c=!c),c&&t.reverse()}(v,r);for(var f=0;f<v.length;f++){var h,m,p,g,b,y,E,w,A,j,x,R,D,T=v[f],M=T.nextWallEl=v[(f+1)%v.length],H=M.object3D.position.x-T.object3D.position.x,k=M.object3D.position.y-T.object3D.position.y,S=M.object3D.position.z-T.object3D.position.z,C=M.getHeight()-T.getHeight(),F=Math.atan2(S,H),I=Math.sqrt(H*H+S*S);T.object3D.rotation.y=THREE.MathUtils.degToRad(-F/Math.PI*180);var z=new THREE.Shape;z.moveTo(0,T.getHeight()),z.lineTo(0,0);var P,q=e(T.doorholes);try{for(q.s();!(P=q.n()).done;){var N=P.value;c(N);var O=N.getDoorlink();if(O)for(var W=-1;W<=1;W+=2){var B=N.object3D.position.x+O.getAttribute("doorlink").width/2*W,V=B/I*k,G=V+O.getAttribute("doorlink").height,L=V+(T.getHeight()+B/I*C)-n;G>L&&(G=L),s(T,N,B,V),s(T,N,B,G),W<0?(z.lineTo(B,V),z.lineTo(B,G)):(z.lineTo(B,G),z.lineTo(B,V))}}}catch(t){q.e(t)}finally{q.f()}z.lineTo(I,(null==M||null===(h=M.object3D)||void 0===h||null===(m=h.position)||void 0===m?void 0:m.y)-(null==T||null===(p=T.object3D)||void 0===p||null===(g=p.position)||void 0===g?void 0:g.y)),z.lineTo(I,(null==M||null===(b=M.object3D)||void 0===b||null===(y=b.position)||void 0===y?void 0:y.y)-(null==T||null===(E=T.object3D)||void 0===E||null===(w=E.position)||void 0===w?void 0:w.y)+M.getHeight());var U=new THREE.ShapeGeometry(z);l(U,"x","y",1,1),a(U);var X=(null==T||null===(A=T.components)||void 0===A||null===(j=A.material)||void 0===j?void 0:j.material)||(null==T||null===(x=T.parentEl)||void 0===x||null===(R=x.components)||void 0===R||null===(D=R.material)||void 0===D?void 0:D.material);T.mesh?(T.mesh.geometry=U,T.mesh.material=X):(T.mesh=new THREE.Mesh(U,X),T.setObject3D("wallMesh",T.mesh))}d(v,null==t?void 0:t.floor,!1,r),d(v,null==t?void 0:t.ceiling,!0,r)}}},517:(t,e,o)=>{o(182)}},e={};function o(r){var n=e[r];if(void 0!==n)return n.exports;var i=e[r]={exports:{}};return t[r](i,i.exports,o),i.exports}return o(24),o(813),o(517),{}})()));
//# sourceMappingURL=aframe-room-component.min.js.map